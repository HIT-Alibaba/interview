## Dalvik与JVM的分析

### 前言

> Dalvik可以支持已转换为.dex（即Dalvik Executable）格式的Java应用程序的运行，.dex格式是专为Dalvik设计的一种压缩格式，适合内存和处理器速度有限的系统。
> dx 是一套工具，可以将 Java .class 转换成 .dex 格式. 一个dex档通常会有多个.class。由于dex有时必须进行最佳化，会使档案大小增加1-4倍，以ODEX结尾。

---

### 区别

- Dalvik 和标准 Java 虚拟机(JVM)的首要差别

Dalvik 基于寄存器，而 JVM 基于栈。基于寄存器的虚拟机对于更大的程序来说，在它们编译的时候，花费的时间更短。 JVM字节码中，局部变量会被放入局部变量表中，继而被压入堆栈供操作码进行运算，当然JVM也可以只使用堆栈而不显式地将局部变量存入变量表中。Dalvik字节码中，局部变量会被赋给65536个可用的寄存器中的任何一个，Dalvik指令直接操作这些寄存器，而不是访问堆栈中的元素。

- Dalvik 和 Java 字节码的区别

VM字节码由.class文件组成，每个文件一个class。JVM在运行的时候为每一个类装载字节码。相反的，Dalvik程序只包含一个.dex文件，这个文件包含了程序中所有的类。Java编译器创建了JVM字节码之后，Dalvik的dx编译器删除.class文件，重新把它们编译成Dalvik字节码，然后把它们写进一个.dex文件中。这个过程包括翻译、重构、解释程序的基本元素（常量池、类定义、数据段）。常量池描述了所有的常量，包括引用、方法名、数值常量等。类定义包括了访问标志、类名等基本信息。数据段中包含各种被VM执行的函数代码以及类和函数的相关信息（例如DVM所需要的寄存器数量、局部变量表、操作数堆栈大小），还有实例变量。

![code](http://oszh5svp5.bkt.clouddn.com/android-dalvik-jvm.jpg)

- Dalvik 和 Java SDK的SDK不同	
- Dalvik 和 Java 运行环境的区别
    - Dalvik 经过优化，允许在有限的内存中同时运行多个虚拟机的实例，并且每一个Dalvik 应用作为一个独立的Linux 进程执行。独立的进程可以防止在虚拟机崩溃的时候所有程序都被关闭
    - Dalvik虚拟机在android2.2之后使用JIT （Just-In-Time）技术，与传统JVM的JIT并不完全相同
    - Dalvik虚拟机有自己的 bytecode，并非使用 java bytecode

---

### 功能

 - Dalvik主要是完成对象生命周期管理，堆栈管理，线程管理，安全和异常管理，以及垃圾回收等等重要功能。 　　
 - Dalvik负责进程隔离和线程管理，每一个android应用在底层都会对应一个独立的Dalvik虚拟机实例，其代码在虚拟机的解释下得以执行。 　　
 - 不同于Java虚拟机运行java字节码，Dalvik虚拟机运行的是其专有的文件格式Dex。 　　
 - dex文件格式可以减少整体文件尺寸，提高I/O操作的类查找速度。 　　
 - odex是为了在运行过程中进一步提高性能，对dex文件的进一步优化。 　　
 - 所有的Android应用的线程都对应一个linux线程，虚拟机因而可以更多的依赖操作系统的线程调度和管理机制。 　　
 - 有一个特殊的虚拟机进程Zygote，他是虚拟机实例的孵化器。它在系统启动的时候就会产生，它会完成虚拟机的初始化、库的加载、预制类库和初始化的操作。如果系统需要一个新的虚拟机实例，它会迅速复制自身，以最快的速度提供给系统。对于一些只读的系统库，所有虚拟机实例都和Zygote共享一块内存区域。

 ---

 - 参考资料：[Dalvik VM (DVM) 与Java VM (JVM)的区别](http://blog.csdn.net/x356982611/article/details/21983267)
 


